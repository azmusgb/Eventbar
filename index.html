<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Velvet Hour Events â€” All-in-One Premium Bartending Kit</title>
<meta name="description" content="Premium bartending by Kate. SPA toolkit: branding, menu designer, calculator, contract, invoice, checklists, marketing, booking. Admin panes appear per tab after PIN.">
<meta name="theme-color" content="#120d12">
<meta property="og:title" content="Velvet Hour Events â€” Premium Bartending by Kate">
<meta property="og:description" content="Signature cocktails, safe service, luxe design.">
<meta property="og:type" content="website">
<meta property="og:image" content="data:image/svg+xml;utf8,<?xml version='1.0' encoding='UTF-8'?><svg xmlns='http://www.w3.org/2000/svg' width='1200' height='630'><defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop stop-color='%23EBCB8B' offset='0'/><stop stop-color='%23E68FA0' offset='1'/></linearGradient></defs><rect width='100%' height='100%' fill='%23130f16'/><circle cx='280' cy='420' r='260' fill='url(%23g)' fill-opacity='.22'/><circle cx='900' cy='230' r='180' fill='url(%23g)' fill-opacity='.18'/><text x='90' y='360' fill='white' font-family='Inter,Segoe UI,Arial' font-size='60' font-weight='800'>Velvet Hour Events</text><text x='90' y='420' fill='white' font-family='Inter,Segoe UI,Arial' font-size='32' opacity='.85'>Premium Bartending by Kate</text></svg>">
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop stop-color='%23EBCB8B'/%3E%3Cstop offset='1' stop-color='%23E68FA0'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect rx='12' width='64' height='64' fill='%23130f16'/%3E%3Cpath d='M20 46c4-6 10-9 12-9s8 3 12 9' fill='none' stroke='url(%23g)' stroke-width='3.5' stroke-linecap='round'/%3E%3Cpath d='M21 31h22M24 31l-2-10a4 4 0 014-5h12a4 4 0 014 5l-2 10' stroke='%23fff' stroke-linecap='round' stroke-width='2' fill='none'/%3E%3C/svg%3E">

<style>
/* ===== Design Tokens ===== */
:root{
  --bg:#130f16; --ink:#f9f7fb; --muted:#d6cfdf; --muted-strong:#bcb1cd; --card:#1a1520; --edge:rgba(255,255,255,.14);
  --gold:#EBCB8B; --rose:#E68FA0; --violet:#b7a0ff;
  --ok:#60d394; --warn:#ffb860; --err:#ff6c6c;
  --radius:20px; --pad:22px; --shadow:0 28px 70px rgba(10,6,12,.48);
  --font: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial;
  --focus: color-mix(in oklab, var(--gold) 70%, white 30%);
  --nav-h:64px;
}
@media (prefers-color-scheme: light){
  :root{ --bg:#fbfafc; --card:#ffffff; --ink:#191720; --muted:#5e5a70; --edge:#ece7f0; --shadow:none }
}
[data-theme="champagne"]{ --bg:#fbfafc; --card:#ffffff; --ink:#191720; --muted:#5e5a70; --edge:#ece7f0; --gold:#b88a44; --rose:#c06072; --shadow:none }
[data-theme="botanical"]{ --bg:#0f1512; --card:#111a15; --ink:#eaf6ef; --muted:#a3c2b1; --edge:rgba(255,255,255,.12); --gold:#9fe4b3; --rose:#c1ffea; }

/* ===== Base ===== */
*{box-sizing:border-box}
html,body{height:100%}
html{scroll-behavior:smooth}
body{
  margin:0;
  background:
    radial-gradient(1200px 800px at 15% -10%, #20182a, transparent 60%),
    radial-gradient(900px 600px at 120% 10%, #2a1b24, transparent 40%),
    var(--bg);
  color:var(--ink); font-family:var(--font); line-height:1.6; -webkit-font-smoothing:antialiased;
}
.container{max-width:1180px; margin:0 auto; padding:28px 20px}
.card{background:color-mix(in oklab, var(--card) 92%, black 8%); border:1px solid var(--edge); border-radius:var(--radius); padding:var(--pad); box-shadow:var(--shadow)}
h1,h2,h3{margin:0 0 12px}
h1{font-size:clamp(28px, 4vw, 36px); letter-spacing:.2px}
.small{color:var(--muted); font-size:13.5px}
hr{border:0; border-top:1px solid var(--edge); margin:12px 0}
a{color:inherit; text-decoration:none}
a:focus-visible, button:focus-visible, input:focus-visible, select:focus-visible, textarea:focus-visible{
  outline:2px solid var(--focus); outline-offset:3px; border-radius:10px
}
kbd{background:#0003; border:1px solid var(--edge); padding:.18em .48em; border-radius:6px; font-size:.85em}

/* ===== SPA Nav ===== */
.nav{position:sticky; top:12px; height:var(--nav-h); backdrop-filter:saturate(1.1) blur(10px); -webkit-backdrop-filter:saturate(1.1) blur(10px);
  z-index:60; margin:-6px -6px 20px; padding:10px 14px; display:flex; gap:14px; align-items:center;
  border:1px solid var(--edge); border-radius:16px; background:color-mix(in oklab, var(--bg) 80%, black 20%);}
.wordmark{font-weight:900; letter-spacing:.2px; font-size:22px; background:linear-gradient(92deg,var(--gold),var(--rose),var(--violet)); -webkit-background-clip:text; background-clip:text; color:transparent}
.badge{font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid var(--edge); color:var(--muted); display:flex; gap:6px; align-items:center}
.iconbtn, .button{font-weight:600; cursor:pointer}
.iconbtn{display:inline-flex; align-items:center; gap:8px; padding:10px 12px; border:1px solid var(--edge); border-radius:12px; background:color-mix(in oklab, var(--bg) 70%, black 30%); min-height:40px}
.button{display:inline-flex; gap:8px; align-items:center; padding:12px 16px; border-radius:12px; border:1px solid var(--edge);
  background:linear-gradient(90deg, color-mix(in oklab, var(--gold) 40%, transparent 60%), color-mix(in oklab, var(--rose) 35%, transparent 65%));
  color:var(--ink); transition:transform .06s ease, box-shadow .12s ease; min-height:44px}
.button:hover{transform:translateY(-1px); box-shadow:0 6px 20px rgba(0,0,0,.18)}
.nav a{padding:8px 10px; border-radius:10px}
.nav a[aria-current="page"]{background:color-mix(in oklab, var(--gold) 16%, transparent 84%); color:var(--ink)}

/* ===== Forms ===== */
select, input[type="text"], input[type="email"], input[type="number"], input[type="date"], textarea{
  width:100%; padding:12px 12px; border-radius:12px; border:1px solid var(--edge);
  background:color-mix(in oklab, var(--bg) 70%, black 30%); color:var(--ink); outline:none;
}
label{font-weight:600; font-size:13px; color:var(--muted-strong)}
.grid-2{display:grid; grid-template-columns:repeat(2,1fr); gap:16px}
.grid-3{display:grid; grid-template-columns:repeat(3,1fr); gap:16px}
@media (max-width:900px){ .grid-3{grid-template-columns:1fr} .grid-2{grid-template-columns:1fr}}

/* ===== View Container ===== */
#app{min-height:60vh}
.view{display:none}
.view.active{display:block}

/* ===== Components used in views ===== */
.menu-card{width:100%; max-width:620px; margin:0 auto; border-radius:22px; border:1px solid var(--edge);
  background: conic-gradient(from 200deg at 50% 30%, color-mix(in oklab,var(--gold) 18%, transparent 82%), transparent 42% 58%, color-mix(in oklab,var(--rose) 16%, transparent 84%) 100%), color-mix(in oklab, var(--card) 92%, black 8%);
  padding:26px; box-shadow:var(--shadow)}
.menu-card .title{font-size:30px; font-weight:900; text-align:center; margin-bottom:6px}
.menu-card .subtitle{font-size:13px; color:var(--muted); text-align:center; margin-bottom:16px}
.menu-item{margin:10px 0}
.menu-note{font-size:12px; opacity:.9; text-align:center; margin-top:10px}

table{width:100%; border-collapse:collapse}
th,td{padding:10px 8px; border-bottom:1px solid var(--edge); text-align:left; vertical-align:top}
.sig-pad{border:1px solid var(--edge); border-radius:12px; background:color-mix(in oklab, var(--bg) 72%, black 28%); width:100%; height:180px}

/* ===== Toasts & Panels ===== */
.toast-wrap{position:fixed; bottom:18px; left:50%; transform:translateX(-50%); z-index:90}
.toast{background:color-mix(in oklab, var(--card) 95%, black 5%); border:1px solid var(--edge); border-radius:12px; padding:10px 14px; margin-top:10px; min-width:220px}
.toast.ok{border-color:color-mix(in oklab,var(--ok) 40%, var(--edge) 60%)}
.toast.warn{border-color:color-mix(in oklab,var(--warn) 40%, var(--edge) 60%)}
.panel{position:fixed; top:0; right:0; width:420px; max-width:100%; height:100%; background:color-mix(in oklab, var(--card) 95%, black 5%); border-left:1px solid var(--edge); box-shadow:var(--shadow); transform:translateX(100%); transition:transform .2s ease; z-index:80; display:flex; flex-direction:column}
.panel[data-open="true"]{transform:none}
.panel header{display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid var(--edge)}
.panel .content{padding:16px; overflow:auto}

:focus-visible{outline:2px solid var(--focus); outline-offset:3px; border-radius:8px}
@media print{ .nav,.no-print{display:none!important} .card{box-shadow:none; border-color:#ddd} body{background:#fff; color:#222} }
</style>

<script type="application/ld+json">
{"@context":"https://schema.org","@type":"LocalBusiness","name":"Velvet Hour Events","description":"Premium mobile bartending by Kate. Signature menus, safe service, luxe presentation. Certified & insured.","areaServed":"Charlotte, NC and Carolinas","email":"hello@velvethourevents.com","telephone":"(704) 000-0000","url":"https://example.invalid/velvet-hour","sameAs":[]}
</script>
</head>
<body data-role="user">
  <noscript><div class="container"><div class="card">This site needs JavaScript enabled.</div></div></noscript>
  <div class="toast-wrap" aria-live="polite" aria-atomic="true"></div>
  <div class="container">
    <!-- NAV -->
    <nav class="nav" role="navigation" aria-label="Primary">
      <div class="wordmark" data-bind="brand" aria-label="Brand">Velvet Hour Events</div>

      <span class="badge">Theme
        <select id="themePick" aria-label="Theme">
          <option value="velvet" selected>Velvet</option>
          <option value="champagne">Champagne</option>
          <option value="botanical">Botanical</option>
        </select>
      </span>

      <span class="badge" id="modeChip" aria-live="polite" title="Current view">Mode: User</span>

      <button class="iconbtn no-print" id="adminLoginBtn" aria-label="Admin login">ðŸ”’ Admin</button>
      <button class="iconbtn no-print" id="adminLogoutBtn" aria-label="Sign out admin" hidden>Sign out</button>

      <div style="margin-left:auto"></div>
      <a href="#packages" data-route>Packages</a>
      <a href="#menus" data-route>Menus</a>
      <a href="#designer" data-route>Designer</a>
      <a href="#calculator" data-route>Calculator</a>
      <a href="#contract" data-route>Contract</a>
      <a href="#invoice" data-route>Invoice</a>
      <a href="#checklists" data-route>Checklists</a>
      <a href="#marketing" data-route>Marketing</a>
      <a href="#contact" data-route>Book</a>
    </nav>

    <!-- SPA outlet -->
    <main id="app" aria-live="polite" aria-busy="false"></main>

    <footer class="small">&copy; 2025 <span data-bind="brand">Velvet Hour Events</span> â€” <span data-bind="city">Charlotte, NC</span></footer>
  </div>

  <!-- PIN Dialog -->
  <section id="pinPanel" class="panel" role="dialog" aria-modal="true" aria-labelledby="pinTitle" aria-hidden="true">
    <header>
      <h3 id="pinTitle">Admin Access</h3>
      <button class="iconbtn" id="closePin" aria-label="Close">âœ–</button>
    </header>
    <div class="content">
      <p class="small">Enter your Admin PIN to reveal per-tab admin panes for this device/session.</p>
      <p><label>PIN<br><input id="pinInput" type="password" autocomplete="one-time-code" placeholder="0000"></label></p>
      <p><label><input id="rememberAdmin" type="checkbox"> Remember admin on this device</label></p>
      <div style="display:flex; gap:8px">
        <button class="button" id="confirmPin">Unlock Admin</button>
        <button class="iconbtn" id="resetPin">Reset PIN to 0000</button>
      </div>
      <p class="small">Note: visibility gating for demos; not a security boundary.</p>
    </div>
  </section>

  <!-- Payment panel (shared) -->
  <section id="payPanel" class="panel" role="dialog" aria-modal="true" aria-labelledby="payTitle" aria-hidden="true">
    <header>
      <h3 id="payTitle">Demo Payment</h3>
      <button class="iconbtn" id="closePay" aria-label="Close">âœ–</button>
    </header>
    <div class="content">
      <p class="small">This is a demo payment flow. Nothing is charged; results are stored locally.</p>
      <p><label>Name on Card<br><input id="pay_name" placeholder="Client Name"></label></p>
      <div class="grid-2">
        <p><label>Amount<br><input id="pay_amount" type="number" min="0" step="0.01"></label></p>
        <p><label>Method<br>
          <select id="pay_method" aria-label="Payment method">
            <option>Card</option><option>ACH</option><option>Cash</option>
          </select></label></p>
      </div>
      <div style="display:flex; gap:8px">
        <button class="button" id="confirmPay">Confirm Payment</button>
        <button class="iconbtn" id="fillInvoiceAmt">Use Invoice Total</button>
      </div>
      <p class="small" id="payNotice"></p>
    </div>
  </section>
  .<script>
/* ====== Core utilities ====== */
const $  = (q, p=document) => p.querySelector(q);
const $$ = (q, p=document) => [...p.querySelectorAll(q)];
const toastWrap = $('.toast-wrap');
function toast(msg, type='ok'){ const d=document.createElement('div'); d.className=`toast ${type}`; d.textContent=msg; toastWrap.appendChild(d); setTimeout(()=>d.remove(), 3200); }
function download(filename, data, type='application/json'){ const blob=new Blob([data],{type}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=filename; a.click(); }

/* ====== Panels ====== */
function openPanel(p){ p.dataset.open="true"; p.setAttribute('aria-hidden','false'); p.querySelector('header button').focus(); }
function closePanel(p){ p.dataset.open="false"; p.setAttribute('aria-hidden','true'); }
$('#closePin').addEventListener('click', ()=> closePanel($('#pinPanel')));
$('#closePay').addEventListener('click', ()=> closePanel($('#payPanel')));

/* ====== Theme ====== */
const themePick=$('#themePick');
function applyTheme(v){
  if(v==='champagne'){document.body.setAttribute('data-theme','champagne');}
  else if(v==='botanical'){document.body.setAttribute('data-theme','botanical');}
  else{document.body.removeAttribute('data-theme');}
  localStorage.setItem('vh_theme', v);
}
themePick.addEventListener('change',e=>applyTheme(e.target.value));
(function(){ const t=localStorage.getItem('vh_theme')||'velvet'; applyTheme(t); themePick.value=t; })();

/* ====== Brand ====== */
const BRAND_DEFAULT={brand:"Velvet Hour Events", email:"hello@velvethourevents.com", phone:"(704) 000-0000", city:"Charlotte, NC"};
let BRAND;
try{ BRAND = JSON.parse(localStorage.getItem('vh_brand')) || {...BRAND_DEFAULT}; } catch{ BRAND={...BRAND_DEFAULT}; }
function applyBrand(){
  $$('[data-bind="brand"]').forEach(el=>el.textContent=BRAND.brand);
  $$('[data-bind="email"]').forEach(el=>el.textContent=BRAND.email);
  $$('[data-bind="phone"]').forEach(el=>el.textContent=BRAND.phone);
  $$('[data-bind="city"]').forEach(el=>el.textContent=BRAND.city);
}
applyBrand();

/* ====== Router skeleton (set after views exist) ====== */
const app = $('#app');
let routerReady = false;
const routes = {}; // will be filled after view functions
function setActiveLink(hash){
  $$('a[data-route]').forEach(a=> a.setAttribute('aria-current', a.getAttribute('href')===hash ? 'page':'false'));
}
function renderRoute(hash){
  const route = routes[hash] ? hash : '#packages';
  setActiveLink(route);
  app.setAttribute('aria-busy','true');
  app.innerHTML='';
  // render user view
  const frag = routes[route]({admin:false});
  app.appendChild(frag);
  // inject admin panes only if admin
  if(isAdmin()){
    routes[route]({admin:true, mount:app});
  }
  app.setAttribute('aria-busy','false');
}

/* ====== Shared helpers ====== */
function money(n){ return `$${(+n||0).toFixed(2)}`; }
function printNode(node, title='Print'){
  const w=window.open('','_blank');
  w.document.write(`<!doctype html><html><head><meta charset="utf-8"><title>${title}</title>
  <style>body{font-family:${getComputedStyle(document.body).fontFamily}; color:#222; margin:20px}
  .small{color:#555} table{width:100%; border-collapse:collapse} th,td{border-bottom:1px solid #ddd; padding:8px; text-align:left; vertical-align:top}
  .menu-card{border:1px solid #ddd; border-radius:22px; padding:26px}</style></head><body>`);
  w.document.body.appendChild(node.cloneNode(true));
  w.document.write('</body></html>'); w.document.close(); w.focus(); w.print();
}

/* ====== View: Packages ====== */
function renderPackages({admin}={}){
  const view=document.createElement('section'); view.className='view active card';
  view.innerHTML=`
    <h2>Packages</h2>
    <div class="grid-3" id="pkgGrid">
      <div class="card"><h3>Essentials</h3>
        <div class="small">4-hr min Â· 1 bartender</div>
        <div class="small">Beer & wine + classic highballs</div>
        <div style="display:flex; gap:8px; align-items:baseline">
          <span class="small">From</span>
          <div id="pkg_essentials" style="font-size:28px; font-weight:900;background:linear-gradient(92deg,var(--ok),var(--gold));-webkit-background-clip:text;background-clip:text;color:transparent">${localStorage.getItem('vh_pkg_essentials')||'$55/hr'}</div>
        </div>
      </div>
      <div class="card" style="border-color:rgba(235,203,139,.55)"><h3>Signature</h3>
        <div class="small">4-hr min Â· 1 bartender</div>
        <div class="small">Two signatures + tasting</div>
        <div style="display:flex; gap:8px; align-items:baseline">
          <span class="small">From</span>
          <div id="pkg_signature" style="font-size:28px; font-weight:900;background:linear-gradient(92deg,var(--ok),var(--gold));-webkit-background-clip:text;background-clip:text;color:transparent">${localStorage.getItem('vh_pkg_signature')||'$65/hr'}</div>
        </div>
      </div>
      <div class="card"><h3>Premier</h3>
        <div class="small">4-hr min Â· 1 bartender</div>
        <div class="small">Zero-proof menu Â· custom signage</div>
        <div style="display:flex; gap:8px; align-items:baseline">
          <span class="small">From</span>
          <div id="pkg_premier" style="font-size:28px; font-weight:900;background:linear-gradient(92deg,var(--ok),var(--gold));-webkit-background-clip:text;background-clip:text;color:transparent">${localStorage.getItem('vh_pkg_premier')||'$85/hr'}</div>
        </div>
      </div>
    </div>
    <p class="small">Holiday dates may price at 1.5Ã—. Client typically supplies alcohol; we provide a detailed shopping plan and serve.</p>
  `;
  if(admin){
    const adminBox=document.createElement('div'); adminBox.className='card'; adminBox.style.marginTop='12px';
    adminBox.innerHTML=`
      <h3>Admin Â· Package Pricing</h3>
      <div class="grid-3">
        <p><label>Essentials (text)<br><input id="ad_pkg_essentials" placeholder="$55/hr" value="${localStorage.getItem('vh_pkg_essentials')||'$55/hr'}"></label></p>
        <p><label>Signature (text)<br><input id="ad_pkg_signature" placeholder="$65/hr" value="${localStorage.getItem('vh_pkg_signature')||'$65/hr'}"></label></p>
        <p><label>Premier (text)<br><input id="ad_pkg_premier" placeholder="$85/hr" value="${localStorage.getItem('vh_pkg_premier')||'$85/hr'}"></label></p>
      </div>
      <button class="button" id="savePkg">Save Package Pricing</button>
    `;
    adminBox.querySelector('#savePkg').addEventListener('click', ()=>{
      const e=$('#ad_pkg_essentials', adminBox).value||'$55/hr';
      const s=$('#ad_pkg_signature', adminBox).value||'$65/hr';
      const p=$('#ad_pkg_premier', adminBox).value||'$85/hr';
      localStorage.setItem('vh_pkg_essentials', e);
      localStorage.setItem('vh_pkg_signature', s);
      localStorage.setItem('vh_pkg_premier', p);
      toast('Package pricing saved');
      renderRoute('#packages');
    });
    view.appendChild(adminBox);
  }
  return view;
}

/* ====== View: Menus ====== */
function renderMenus({admin}={}){
  const [m1,m2,m3] = JSON.parse(localStorage.getItem('vh_menu_templates')||'null') || [
    '<ul class="menu"><li><b>Signatures:</b> French 75 â€” gin, lemon, bubbles</li><li>Old Fashioned â€” bourbon, bitters, orange</li><li><b>House:</b> Gin & Tonic Â· Vodka Soda Â· Paloma</li><li><b>Zero-Proof:</b> Citrus & Mint Cooler</li></ul>',
    '<ul class="menu"><li><b>Signatures:</b> Strawberry Basil Smash Â· Cucumber Gimlet</li><li>Spritz station Â· Hard seltzers</li><li><b>Zero-Proof:</b> Watermelon Fizz</li></ul>',
    '<ul class="menu"><li><b>Signatures:</b> Espresso Martini Â· Ginger Pear Whiskey</li><li>Beer/Wine only option</li><li><b>Zero-Proof:</b> Spiced Apple Fizz</li></ul>'
  ];
  const view=document.createElement('section'); view.className='view active card';
  view.innerHTML=`
    <div style="display:flex; align-items:center; justify-content:space-between; gap:10px">
      <h2>Menu Templates</h2>
      <div class="no-print" style="display:flex; gap:8px"><button class="button" id="printPage">Print</button></div>
    </div>
    <div class="grid-3">
      <div class="card">${m1}</div>
      <div class="card">${m2}</div>
      <div class="card">${m3}</div>
    </div>
  `;
  $('#printPage', view).addEventListener('click', ()=> printNode(view, 'Menus'));

  if(admin){
    const adminBox=document.createElement('div'); adminBox.className='card'; adminBox.style.marginTop='12px';
    adminBox.innerHTML=`
      <h3>Admin Â· Templates</h3>
      <p class="small">Enter simple UL/LI markup; basic tags only.</p>
      <div class="grid-3">
        <p><label>Template 1<br><textarea id="ad_menu1" rows="7">${m1}</textarea></label></p>
        <p><label>Template 2<br><textarea id="ad_menu2" rows="7">${m2}</textarea></label></p>
        <p><label>Template 3<br><textarea id="ad_menu3" rows="7">${m3}</textarea></label></p>
      </div>
      <button class="button" id="saveMenus">Save Templates</button>
    `;
    adminBox.querySelector('#saveMenus').addEventListener('click', ()=>{
      const vals=[$('#ad_menu1',adminBox).value,$('#ad_menu2',adminBox).value,$('#ad_menu3',adminBox).value];
      localStorage.setItem('vh_menu_templates', JSON.stringify(vals));
      toast('Templates updated'); renderRoute('#menus');
    });
    view.appendChild(adminBox);
  }
  return view;
}

/* ====== View: Designer ====== */
function renderDesigner({admin}={}){
  const view=document.createElement('section'); view.className='view active card';
  view.innerHTML=`
    <div style="display:flex; align-items:center; justify-content:space-between; gap:10px">
      <h2>Menu Designer (Print-ready)</h2>
      <div class="no-print" style="display:flex; gap:8px">
        <button class="button" id="btnPreview">Preview</button>
        <button class="button" id="btnPrint">Print Card</button>
      </div>
    </div>
    <div class="grid-2">
      <div>
        <div class="grid-2">
          <p><label>Event Name<br><input id="m_event" placeholder="Ava & Noah â€” 10Â·19Â·25"></label></p>
          <p><label>Subtitle<br><input id="m_sub" placeholder="Signature Cocktails + Zero-Proof"></label></p>
        </div>
        <p><label>Signature #1<br><input id="m_s1" value="French 75 â€” gin, lemon, bubbles"></label></p>
        <p><label>Signature #2<br><input id="m_s2" value="Old Fashioned â€” bourbon, bitters, orange"></label></p>
        <p><label>House Staples (comma)<br><input id="m_house" value="Gin & Tonic, Vodka Soda, Paloma"></label></p>
        <p><label>Zero-Proof<br><input id="m_zero" value="Citrus & Mint Cooler"></label></p>
        <div class="grid-3">
          <p><label>Accent Style<br>
            <select id="m_style" aria-label="Menu accent style">
              <option value="velvet">Velvet Luxe</option>
              <option value="minimal">Minimal</option>
              <option value="lively">Lively</option>
            </select>
          </label></p>
          <p><label>Include footer note?<br><select id="m_note"><option>Yes</option><option>No</option></select></label></p>
          <p><label>Brand at footer?<br><select id="m_brand"><option>Yes</option><option>No</option></select></label></p>
        </div>
      </div>
      <div id="menuPreview">
        <div class="menu-card" id="menuCard">
          <div class="title" id="mc_title">Ava & Noah â€” 10Â·19Â·25</div>
          <div class="subtitle" id="mc_sub">Signature Cocktails + Zero-Proof</div>
          <div class="menu-item" id="mc_s1"><b>French 75</b> â€” gin, lemon, bubbles</div>
          <div class="menu-item" id="mc_s2"><b>Old Fashioned</b> â€” bourbon, bitters, orange</div>
          <div class="menu-item" id="mc_house"><b>House:</b> Gin & Tonic Â· Vodka Soda Â· Paloma</div>
          <div class="menu-item" id="mc_zero"><b>Zero-Proof:</b> Citrus & Mint Cooler</div>
          <div class="menu-note" id="mc_note">Please drink responsibly Â· IDs required</div>
          <div class="menu-note" id="mc_brand">â€” <span data-bind="brand">${BRAND.brand}</span> â€”</div>
        </div>
      </div>
    </div>
    <p class="small">Tip: <kbd>Ctrl/Cmd+P</kbd> â†’ Margins: None. Prints on 5Ã—7 or A5.</p>
  `;
  function titleCaseDrink(s){ return s.replace(/^\s*([^-â€”â€“:]+)[-â€”â€“:]?\s*/,(m,name)=>`<b>${name.trim()}</b> â€” `); }
  function renderMenu(){
    const t=$('#m_event',view).value||"Our Event";
    const sub=$('#m_sub',view).value||"";
    const s1=$('#m_s1',view).value||"";
    const s2=$('#m_s2',view).value||"";
    const house=$('#m_house',view).value||"";
    const zero=$('#m_zero',view).value||"";
    const style=$('#m_style',view).value;
    const noteOn=$('#m_note',view).value==="Yes";
    const brandOn=$('#m_brand',view).value==="Yes";
    $('#mc_title',view).textContent=t; $('#mc_sub',view).textContent=sub;
    $('#mc_s1',view).innerHTML=titleCaseDrink(s1); $('#mc_s2',view).innerHTML=titleCaseDrink(s2);
    $('#mc_house',view).innerHTML=`<b>House:</b> ${house.split(',').map(s=>s.trim()).filter(Boolean).join(' Â· ')}`;
    $('#mc_zero',view).innerHTML=`<b>Zero-Proof:</b> ${zero}`;
    $('#mc_note',view).style.display = noteOn?'block':'none';
    $('#mc_brand',view).style.display = brandOn?'block':'none';
    const card=$('#menuCard',view);
    card.style.background={
      velvet:"conic-gradient(from 200deg at 50% 30%, color-mix(in oklab,var(--gold) 18%, transparent 82%), transparent 42% 58%, color-mix(in oklab,var(--rose) 16%, transparent 84%) 100%), color-mix(in oklab, var(--card) 92%, black 8%)",
      minimal:"color-mix(in oklab, var(--card) 94%, black 6%)",
      lively:"radial-gradient(700px 220px at 10% -30%, color-mix(in oklab,var(--violet) 24%, transparent 76%), transparent), radial-gradient(420px 200px at 90% 120%, color-mix(in oklab, var(--gold) 22%, transparent 78%), transparent), color-mix(in oklab, var(--card) 92%, black 8%)"
    }[style]||card.style.background;
  }
  $('#btnPreview',view).addEventListener('click', renderMenu);
  $('#btnPrint',view).addEventListener('click', ()=>{ renderMenu(); printNode($('#menuCard',view), 'Menu'); });
  renderMenu();
  return view;
}

/* ====== View: Calculator ====== */
function renderCalculator({admin}={}){
  const view=document.createElement('section'); view.className='view active card';
  view.innerHTML=`
    <div style="display:flex; align-items:center; justify-content:space-between">
      <h2>Shopping Calculator</h2>
      <div class="no-print" style="display:flex; gap:8px">
        <button class="button" id="btnCalc">Calculate</button>
        <button class="button" id="btnCSV">Export CSV</button>
      </div>
    </div>
    <p class="small">Rule: 1.5 drinks first hour, then ~1/hr. 750ml â‰ˆ 16 cocktails. Wine â‰ˆ 5 pours. Beer case â‰ˆ 24.</p>
    <form class="grid-3 no-print" aria-label="Shopping calculator input">
      <p><label>Guests<br><input id="c_guests" type="number" value="100" min="1"></label></p>
      <p><label>Hours of Service<br><input id="c_hours" type="number" value="4" min="1"></label></p>
      <p><label>Ice per guest (lbs)<br><input id="c_ice" type="number" value="1.5" step="0.1"></label></p>
      <p><label>% Cocktails<br><input id="c_pc" type="number" value="40" min="0" max="100"></label></p>
      <p><label>% Beer<br><input id="c_pb" type="number" value="35" min="0" max="100"></label></p>
      <p><label>% Wine<br><input id="c_pw" type="number" value="25" min="0" max="100"></label></p>
      <p class="grid-2" style="grid-column:1/-1"><label>Cocktail bases (comma separated)<br><input id="c_bases" value="vodka, tequila, bourbon"></label></p>
      <p class="grid-2" style="grid-column:1/-1"><label>Garnish set (comma separated)<br><input id="c_garn" value="lemon, lime, orange, cherry"></label></p>
    </form>
    <pre id="calc_out" style="white-space:pre-wrap; border:1px solid var(--edge); padding:12px; border-radius:12px; background:color-mix(in oklab, var(--bg) 70%, black 30%)" aria-live="polite"></pre>
  `;
  function calcRun(){
    const g=+$('#c_guests',view).value||0, h=+$('#c_hours',view).value||0;
    const pc=(+$('#c_pc',view).value||0)/100, pb=(+$('#c_pb',view).value||0)/100, pw=(+$('#c_pw',view).value||0)/100;
    const bases=($('#c_bases',view).value||'').split(',').map(s=>s.trim()).filter(Boolean);
    const drinksPerGuest=1.5+Math.max(h-1,0)*1.0;
    const total=Math.round(g*drinksPerGuest);
    const cocktails=Math.round(total*pc), beer=Math.round(total*pb), wine=Math.round(total*pw);
    const spiritBottles=Math.ceil(cocktails/16), perBase=Math.ceil(spiritBottles/Math.max(1,bases.length));
    const wineBottles=Math.ceil(wine/5), beerCases=Math.ceil(beer/24);
    const ice=Math.ceil((+$('#c_ice',view).value||1.5)*g);
    const glassware=Math.ceil(g*(h>=4?3:2));
    const mixerLiters=(cocktails*0.75)/33.8, syrupLiters=(cocktails*0.25)/33.8, citrus=Math.ceil(cocktails*0.5/12), cherryOlive=Math.ceil(cocktails*0.5);
    const lines=[
      `Guests: ${g} Â· Hours: ${h}`,
      `Estimated total drinks: ${total}`,
      ``,
      `COCKTAILS ~ ${cocktails} pours â†’ ~${spiritBottles} Ã— 750ml`,
      `  Bases: ${bases.join(", ")||"choose bases"} â†’ ~${perBase} each`,
      `BEER ~ ${beer} pours â†’ ~${beerCases} case(s)`,
      `WINE ~ ${wine} glasses â†’ ~${wineBottles} bottles`,
      ``,
      `MIXERS: ~${mixerLiters.toFixed(1)} L Â· SYRUP: ~${syrupLiters.toFixed(1)} L`,
      `CITRUS set: ~${citrus} pieces Â· GARNISH (cherry/olive): ~${cherryOlive}`,
      `ICE: ~${ice} lbs Â· GLASSWARE: ${glassware}`
    ];
    $('#calc_out',view).textContent=lines.join('\n');
    view._calcCSV=[["Item","Qty","Unit"],
      ["Base spirits (750ml total)",spiritBottles,"bottles"],
      ["Beer",beerCases,"cases"],
      ["Wine (750ml)",wineBottles,"bottles"],
      ["Mixers",mixerLiters.toFixed(1),"L"],
      ["Simple syrup",syrupLiters.toFixed(1),"L"],
      ["Citrus (mixed)",citrus,"pieces"],
      ["Cherries/olives",cherryOlive,"units"],
      ["Ice",ice,"lbs"],
      ["Cups/Glassware",glassware,"each"]
    ];
  }
  function calcExport(){
    if(!view._calcCSV) calcRun();
    const rows=view._calcCSV.map(r=>r.join(','));
    download('shopping_list.csv', rows.join('\n'), 'text/csv');
  }
  $('#btnCalc',view).addEventListener('click', calcRun);
  $('#btnCSV',view).addEventListener('click', calcExport);
  calcRun();
  return view;
}

/* ====== View: Contract ====== */
function renderContract({admin}={}){
  const view=document.createElement('section'); view.className='view active card';
  view.innerHTML=`
    <div style="display:flex; align-items:center; justify-content:space-between; gap:10px">
      <h2>Service Agreement</h2>
      <div class="no-print" style="display:flex; gap:8px">
        <button class="button" id="printContract">Print</button>
        <button class="button" id="clearSigs">Clear signatures</button>
      </div>
    </div>
    <div class="small">Provider: <b data-bind="brand">${BRAND.brand}</b> â€” <span data-bind="email">${BRAND.email}</span> â€” <span data-bind="phone">${BRAND.phone}</span></div>
    <hr>
    <div class="grid-2">
      <p><label>Client<br><input id="cl_name"></label></p>
      <p><label>Event Date<br><input id="cl_date" type="date"></label></p>
    </div>
    <div class="grid-2">
      <p><label>Start Time<br><input id="cl_start" placeholder="5:00 PM"></label></p>
      <p><label>End Time<br><input id="cl_end" placeholder="9:00 PM"></label></p>
    </div>
    <p><label>Venue<br><input id="cl_venue" placeholder="Venue / Address"></label></p>
    <h3>Scope</h3>
    <ul><li>Bartending service; bar setup & cleanup.</li><li>Menu per proposal; quantity planning; garnish kit & tools.</li><li>Client supplies alcohol unless otherwise agreed in writing.</li></ul>
    <h3>Fees & Payment</h3>
    <ul><li>Rate as quoted; 4-hour minimum unless specified.</li><li>Retainer: 30% due upon signing; balance due 3 days prior.</li><li>Holiday dates may be billed at 1.5Ã—.</li></ul>
    <h3>Insurance & Compliance</h3>
    <ul><li>General & liquor liability insurance; COI available on request.</li><li>Responsible alcohol service; IDs checked; service may be refused for safety.</li></ul>
    <h3>Client Responsibilities</h3>
    <ul><li>Provide bar space, water, power, trash, and ice unless contracted.</li><li>Obtain venue permissions/permits as applicable.</li></ul>
    <h3>Cancellation</h3>
    <ul><li>â‰¥30 days: retainer refundable less $50 admin; 7â€“29 days: 50%; &lt;7 days: 100%.</li></ul>
    <h3>Liability</h3>
    <ul><li>Provider not liable for unattended property, guest misconduct, or venue hazards.</li></ul>
    <div class="grid-2">
      <div>
        <p><b>Client Signature</b></p>
        <canvas id="sigClient" class="sig-pad"></canvas>
        <div class="no-print" style="display:flex; gap:8px; margin-top:8px">
          <button class="button" id="sigClientClear">Clear</button>
          <button class="button" id="sigClientSave">Save</button>
        </div>
      </div>
      <div>
        <p><b>Provider Signature â€” <span data-bind="brand">${BRAND.brand}</span></b></p>
        <canvas id="sigProvider" class="sig-pad"></canvas>
        <div class="no-print" style="display:flex; gap:8px; margin-top:8px">
          <button class="button" id="sigProviderClear">Clear</button>
          <button class="button" id="sigProviderSave">Save</button>
        </div>
      </div>
    </div>
    <p class="small">Template only â€” confirm state/venue requirements.</p>
  `;
  function serialize(){ return { name:$('#cl_name',view).value, date:$('#cl_date',view).value, start:$('#cl_start',view).value, end:$('#cl_end',view).value, venue:$('#cl_venue',view).value }; }
  function load(obj){ if(!obj) return; $('#cl_name',view).value=obj.name||''; $('#cl_date',view).value=obj.date||''; $('#cl_start',view).value=obj.start||''; $('#cl_end',view).value=obj.end||''; $('#cl_venue',view).value=obj.venue||''; }
  ['cl_name','cl_date','cl_start','cl_end','cl_venue'].forEach(id=> $('#'+id,view).addEventListener('input',()=> localStorage.setItem('vh_contract', JSON.stringify(serialize())) ));
  try{ load(JSON.parse(localStorage.getItem('vh_contract'))); } catch{}

  function wireSig(id){
    const c=$('#'+id,view), ctx=c.getContext('2d');
    function resize(){ const ratio=Math.max(1,Math.floor(window.devicePixelRatio||1)); const r=c.getBoundingClientRect(); c.width=Math.floor(r.width*ratio); c.height=Math.floor(r.height*ratio); ctx.setTransform(ratio,0,0,ratio,0,0); ctx.lineWidth=2; ctx.lineCap='round'; ctx.strokeStyle='#111'; }
    resize(); window.addEventListener('resize',resize,{passive:true});
    let d=false, lx=0, ly=0;
    c.addEventListener('pointerdown',e=>{d=true; const r=c.getBoundingClientRect(); lx=e.clientX-r.left; ly=e.clientY-r.top; c.setPointerCapture(e.pointerId);});
    c.addEventListener('pointerup',e=>{d=false; c.releasePointerCapture?.(e.pointerId);});
    c.addEventListener('pointerleave',()=>d=false);
    c.addEventListener('pointermove',e=>{ if(!d) return; const r=c.getBoundingClientRect(), x=e.clientX-r.left, y=e.clientY-r.top; ctx.beginPath(); ctx.moveTo(lx,ly); ctx.lineTo(x,y); ctx.stroke(); lx=x; ly=y; });
    return {clear:()=>ctx.clearRect(0,0,c.width,c.height), save:()=>{ const a=document.createElement('a'); a.href=c.toDataURL('image/png'); a.download=id+'.png'; a.click(); }};
  }
  const sigC=wireSig('sigClient'), sigP=wireSig('sigProvider');
  $('#sigClientClear',view).addEventListener('click', sigC.clear);
  $('#sigClientSave',view).addEventListener('click', sigC.save);
  $('#sigProviderClear',view).addEventListener('click', sigP.clear);
  $('#sigProviderSave',view).addEventListener('click', sigP.save);
  $('#printContract',view).addEventListener('click', ()=> printNode(view, 'Contract'));
  $('#clearSigs',view).addEventListener('click', ()=>{ sigC.clear(); sigP.clear(); });

  if(admin){
    const adminBox=document.createElement('div'); adminBox.className='card'; adminBox.style.marginTop='12px';
    adminBox.innerHTML=`
      <h3>Admin Â· Contract</h3>
      <button class="iconbtn" id="exportContract">Export JSON</button>
      <label class="iconbtn">Import JSON<input id="importContract" type="file" hidden accept="application/json"></label>
    `;
    adminBox.querySelector('#exportContract').addEventListener('click', ()=> download('contract.json', JSON.stringify(serialize(),null,2)));
    adminBox.querySelector('#importContract').addEventListener('change', e=>{
      const f=e.target.files[0]; if(!f) return; f.text().then(t=>{ try{ const obj=JSON.parse(t); localStorage.setItem('vh_contract', JSON.stringify(obj)); load(obj); toast('Contract imported'); }catch{ toast('Invalid JSON','warn'); }});
    });
    view.appendChild(adminBox);
  }
  return view;
}

/* ====== View: Invoice ====== */
function renderInvoice({admin}={}){
  let saved;
  try{ saved=JSON.parse(localStorage.getItem('vh_invoice'))||null; }catch{ saved=null; }
  saved = saved || {no:'0001',rows:[{desc:'Bartending â€” Signature Package',qty:4,rate:65}],tax:0,tip:15,disc:0};

  const view=document.createElement('section'); view.className='view active card';
  view.innerHTML=`
    <div style="display:flex; align-items:center; justify-content:space-between; gap:10px">
      <h2>Invoice</h2>
      <div class="no-print" style="display:flex; gap:8px">
        <button class="button" id="addLine">Add Line</button>
        <button class="button" id="updateTotals">Update Total</button>
        <button class="button" id="openPay">Pay Now (Demo)</button>
        <button class="iconbtn" id="printInvoice">Print</button>
      </div>
    </div>
    <div class="grid-2">
      <div>
        <b data-bind="brand">${BRAND.brand}</b><br>
        <span data-bind="city">${BRAND.city}</span><br>
        <span data-bind="email">${BRAND.email}</span> Â· <span data-bind="phone">${BRAND.phone}</span>
      </div>
      <div>
        <div class="small">Date: <span id="inv_date">â€”</span></div>
        <div class="small">Invoice #: <input id="inv_no" style="width:140px" value="${saved.no||'0001'}" aria-label="Invoice number"></div>
      </div>
    </div>
    <hr>
    <table id="inv_tbl">
      <thead><tr><th>Description</th><th style="width:90px">Qty</th><th style="width:90px">Rate</th><th style="width:110px">Amount</th></tr></thead>
      <tbody id="inv_body"></tbody>
      <tfoot>
        <tr><td colspan="3" style="text-align:right"><b>Subtotal</b></td><td id="inv_sub">$0.00</td></tr>
        <tr><td colspan="3" style="text-align:right">Tax</td><td><input id="inv_tax" type="number" value="${saved.tax||0}" min="0" step="1"></td></tr>
        <tr><td colspan="3" style="text-align:right">Service/Gratuity %</td><td><input id="inv_tip" type="number" value="${saved.tip||0}" min="0" step="1"></td></tr>
        <tr><td colspan="3" style="text-align:right">Discount</td><td><input id="inv_disc" type="number" value="${saved.disc||0}" min="0" step="1"></td></tr>
        <tr><td colspan="3" style="text-align:right"><b>Total</b></td><td id="inv_tot"><b>$0.00</b></td></tr>
      </tfoot>
    </table>
    <p class="small">Demo payments are logged locally (see Marketing â†’ Payments table when Admin).</p>
  `;
  const body=$('#inv_body',view);
  function pushRow(r={desc:'Item', qty:1, rate:0}){
    const tr=document.createElement('tr');
    tr.innerHTML=`<td contenteditable>${r.desc||'Item'}</td><td><input type="number" value="${r.qty||0}" min="0" step="0.5"></td><td><input type="number" value="${r.rate||0}" min="0" step="1"></td><td class="amt">$0.00</td>`;
    body.appendChild(tr);
  }
  (saved.rows||[]).forEach(pushRow);
  function serialize(){
    return {
      no: $('#inv_no',view).value,
      rows: $$('#inv_tbl tbody tr',view).map(tr=>({desc: tr.cells[0].innerText.trim(), qty:+tr.cells[1].querySelector('input').value||0, rate:+tr.cells[2].querySelector('input').value||0})),
      tax:+$('#inv_tax',view).value||0,
      tip:+$('#inv_tip',view).value||0,
      disc:+$('#inv_disc',view).value||0
    };
  }
  function calc(){
    let sub=0;
    $$('#inv_tbl tbody tr',view).forEach(tr=>{
      const qty=+tr.querySelector('td:nth-child(2) input').value||0;
      const rate=+tr.querySelector('td:nth-child(3) input').value||0;
      const amt=qty*rate; sub+=amt;
      tr.querySelector('.amt').textContent=money(amt);
    });
    $('#inv_sub',view).textContent=money(sub);
    const tax=+$('#inv_tax',view).value||0, tipPct=+$('#inv_tip',view).value||0, discount=+$('#inv_disc',view).value||0;
    const tot=sub + tax + (sub*(tipPct/100)) - discount;
    $('#inv_tot',view).innerHTML=`<b>${money(tot)}</b>`;
    localStorage.setItem('vh_invoice', JSON.stringify(serialize()));
  }
  $('#addLine',view).addEventListener('click', ()=>{ pushRow(); calc(); });
  $('#updateTotals',view).addEventListener('click', calc);
  $('#printInvoice',view).addEventListener('click', ()=> printNode(view, 'Invoice'));
  (function(){ const d=new Date(); const f=n=>n.toString().padStart(2,'0'); $('#inv_date',view).textContent=`${d.getFullYear()}-${f(d.getMonth()+1)}-${f(d.getDate())}`; })();
  calc();

  $('#openPay',view).addEventListener('click', ()=>{
    $('#pay_name').value = $('#cl_name')?.value || '';
    $('#pay_amount').value = $('#inv_tot',view).innerText.replace(/[^0-9.]/g,'') || '0.00';
    $('#pay_method').value = 'Card';
    $('#payNotice').textContent='';
    openPanel($('#payPanel'));
  });

  if(admin){
    const adminBox=document.createElement('div'); adminBox.className='card'; adminBox.style.marginTop='12px';
    adminBox.innerHTML=`
      <h3>Admin Â· Invoice</h3>
      <button class="iconbtn" id="exportInv">Export JSON</button>
      <label class="iconbtn">Import JSON<input id="importInv" type="file" hidden accept="application/json"></label>
    `;
    adminBox.querySelector('#exportInv').addEventListener('click', ()=> download('invoice.json', JSON.stringify(serialize(),null,2)));
    adminBox.querySelector('#importInv').addEventListener('change', e=>{
      const f=e.target.files[0]; if(!f) return; f.text().then(t=>{ try{ const obj=JSON.parse(t); localStorage.setItem('vh_invoice', JSON.stringify(obj)); toast('Invoice imported'); renderRoute('#invoice'); }catch{ toast('Invalid JSON','warn'); }});
    });
    view.appendChild(adminBox);
  }
  return view;
}

/* ====== View: Checklists ====== */
function renderChecklists({admin}={}){
  const view=document.createElement('section'); view.className='view active card';
  view.innerHTML=`
    <div style="display:flex; align-items:center; justify-content:space-between; gap:10px">
      <h2>Service Checklists & Incident Log</h2>
      <div class="no-print" style="display:flex; gap:8px">
        <button class="button" id="printChk">Print</button>
      </div>
    </div>
    <h3>Pre-Event (48â€“72h)</h3>
    <ul><li>Confirm headcount, menu, glassware, ice plan</li><li>Send shopping list & quantities</li><li>COI wording if needed</li><li>Pack kit; label bins; confirm travel/parking</li></ul>
    <h3>On-Site Setup (90â€“120m)</h3>
    <ul><li>Walkthrough: bar location, water, trash, power</li><li>Station: tools, garnishes, signage, spill mats</li><li>Safety: ID checks; incident log ready</li></ul>
    <h3>Teardown</h3>
    <ul><li>Close tabs; secure alcohol per client direction</li><li>Bag trash; wipe surfaces; inventory tools</li><li>Thank planner/host; request testimonial</li></ul>
    <hr>
    <h3>Incident & Refusal Log</h3>
    <table id="incidentTbl">
      <thead><tr><th>Date/Time</th><th>Name/Desc</th><th>Reason</th><th>Actions Taken</th><th>Staff</th></tr></thead>
      <tbody id="incidentBody"><tr><td contenteditable></td><td contenteditable></td><td contenteditable>Over-service / No ID / Aggressive / Other</td><td contenteditable>Water/food Â· Notified planner/security Â· Rideshare</td><td contenteditable></td></tr></tbody>
    </table>
    <div class="no-print" style="margin-top:10px; display:flex; gap:8px">
      <button class="button" id="addIncident">Add row</button>
    </div>
    <blockquote class="small">Refusal script: "For your safety, I'm not able to serve that right now. I'm happy to get you water or food, or a rideshare if you need it."</blockquote>
  `;
  $('#printChk',view).addEventListener('click', ()=> printNode(view, 'Checklists'));
  $('#addIncident',view).addEventListener('click', ()=>{ const tr=document.createElement('tr'); tr.innerHTML="<td contenteditable></td><td contenteditable></td><td contenteditable></td><td contenteditable></td><td contenteditable></td>"; $('#incidentBody',view).appendChild(tr); });
  try{
    const s=localStorage.getItem('vh_incidents'); if(s){ const rows=JSON.parse(s); const body=$('#incidentBody',view); body.innerHTML=''; rows.forEach(cols=>{ const tr=document.createElement('tr'); tr.innerHTML=cols.map(c=>`<td contenteditable>${c}</td>`).join(''); body.appendChild(tr); }); }
  }catch{}

  if(admin){
    const adminBox=document.createElement('div'); adminBox.className='card'; adminBox.style.marginTop='12px';
    adminBox.innerHTML=`
      <h3>Admin Â· Incidents</h3>
      <div style="display:flex; gap:8px">
        <button class="iconbtn" id="saveInc">Save Draft</button>
        <button class="iconbtn" id="exportInc">Export JSON</button>
        <label class="iconbtn">Import JSON<input id="importInc" type="file" hidden accept="application/json"></label>
      </div>
    `;
    adminBox.querySelector('#saveInc').addEventListener('click', ()=>{
      const rows=$$('#incidentBody tr',view).map(tr=>[...tr.cells].map(td=>td.innerText));
      localStorage.setItem('vh_incidents', JSON.stringify(rows)); toast('Incidents saved');
    });
    adminBox.querySelector('#exportInc').addEventListener('click', ()=>{
      const rows=$$('#incidentBody tr',view).map(tr=>[...tr.cells].map(td=>td.innerText));
      download('incidents.json', JSON.stringify(rows,null,2));
    });
    adminBox.querySelector('#importInc').addEventListener('change', e=>{
      const f=e.target.files[0]; if(!f) return; f.text().then(t=>{ try{ const obj=JSON.parse(t); localStorage.setItem('vh_incidents', JSON.stringify(obj)); toast('Imported'); renderRoute('#checklists'); }catch{ toast('Invalid JSON','warn'); }});
    });
    view.appendChild(adminBox);
  }
  return view;
}

/* ====== View: Marketing (Brand + Payments in Admin) ====== */
function renderMarketing({admin}={}){
  const view=document.createElement('section'); view.className='view active card';
  view.innerHTML=`
    <div style="display:flex; align-items:center; justify-content:space-between; gap:10px">
      <h2>Marketing Kit</h2>
      <div class="no-print" style="display:flex; gap:8px">
        <button class="button" id="dlCalendar">Content Calendar (CSV)</button>
        <button class="button" id="copyRate">Copy 1-pager text</button>
      </div>
    </div>
    <h3>Brand Bio</h3>
    <p>Hi, I'm Kate â€” lead bartender behind <b data-bind="brand">${BRAND.brand}</b>. I craft menus that match your vibe and run a calm, safe bar that stays on schedule. Certified, insured, detail-obsessed.</p>
    <h3>Instagram Bio (120â€“150 chars)</h3>
    <pre class="small">Premium bartending Â· weddings & parties Â· certified + insured Â· signature cocktails Â· ${BRAND.city} Â· Inquire â†“</pre>
    <h3>Outreach Scripts</h3>
<pre class="small">Planner/venue DM:
Hi {{first_name}} â€” I run {{brand}}, a certified & insured event bartending team serving {{city/region}}.
We handle menus, quantities, and smooth, on-time service. Can I send a 1-page rate sheet and COI?

COI request (to insurer):
Please issue a certificate naming {{Venue Name}} as additional insured for {{Event Date}}.
Send as PDF to {{client email}} and cc ${BRAND.email}. Thank you.</pre>
    <h3>Rate Sheet (copy text)</h3>
    <pre id="rateSheet" class="small">â€¢ Essentials â€” from ${localStorage.getItem('vh_pkg_essentials')||'$55/hr'} (beer, wine, highballs; shopping plan; garnish kit)
â€¢ Signature â€” from ${localStorage.getItem('vh_pkg_signature')||'$65/hr'} (2 signatures + tasting; elevated garnish & signage)
â€¢ Premier â€” from ${localStorage.getItem('vh_pkg_premier')||'$85/hr'} (signatures + zero-proof menu; custom signage)
â€¢ Add-ons: extra bartenders, menu boards, glassware, mobile bar.
â€¢ TIPS/ServSafe certified. Liquor liability; COI available.
â€¢ Service area: ${BRAND.city} + Carolinas. Inquire: ${BRAND.email} Â· ${BRAND.phone}</pre>
  `;
  $('#dlCalendar',view).addEventListener('click', ()=>{
    const rows=[["Week","Platform","Content","Hashtags"],
      ["1","Instagram","Behind the scenes: Menu creation","#Bartending #EventPlanning #Mixology"],
      ["2","Instagram","Signature cocktail showcase","#Cocktails #Drinks #BartenderLife"],
      ["3","Facebook","Client testimonial feature","#Events #WeddingBartender #CharlotteEvents"]];
    const csv=rows.map(r=>r.join(',')).join('\n'); download('content_calendar.csv', csv, 'text/csv'); toast('Calendar downloaded');
  });
  $('#copyRate',view).addEventListener('click', ()=>{
    navigator.clipboard.writeText($('#rateSheet',view).textContent).then(()=> toast('Rate sheet copied')).catch(()=> toast('Copy failed','warn'));
  });

  if(admin){
    const adminBox=document.createElement('div'); adminBox.className='card'; adminBox.style.marginTop='12px';
    adminBox.innerHTML=`
      <h3>Admin Â· Brand & Payments</h3>
      <div class="grid-2">
        <p><label>Brand Name<br><input id="ad_brand" value="${BRAND.brand}"></label></p>
        <p><label>City/Region<br><input id="ad_city" value="${BRAND.city}"></label></p>
      </div>
      <div class="grid-2">
        <p><label>Email<br><input id="ad_email" type="email" value="${BRAND.email}"></label></p>
        <p><label>Phone<br><input id="ad_phone" value="${BRAND.phone}"></label></p>
      </div>
      <div style="display:flex; gap:8px; margin:6px 0 14px">
        <button class="button" id="saveBrand">Save Brand</button>
        <button class="iconbtn" id="resetBrand">Reset</button>
        <button class="iconbtn" id="exportBrand">Export</button>
        <label class="iconbtn">Import<input id="importBrand" type="file" hidden accept="application/json"></label>
      </div>
      <h4>Payments (Demo)</h4>
      <div id="paymentsList" class="small">No payments yet.</div>
    `;
    adminBox.querySelector('#saveBrand').addEventListener('click', ()=>{
      BRAND = {...BRAND,
        brand:$('#ad_brand',adminBox).value.trim()||BRAND.brand,
        city:$('#ad_city',adminBox).value.trim()||BRAND.city,
        email:$('#ad_email',adminBox).value.trim()||BRAND.email,
        phone:$('#ad_phone',adminBox).value.trim()||BRAND.phone
      };
      localStorage.setItem('vh_brand', JSON.stringify(BRAND)); applyBrand(); toast('Brand saved'); renderRoute('#marketing');
    });
    adminBox.querySelector('#resetBrand').addEventListener('click', ()=>{ BRAND={...BRAND_DEFAULT}; localStorage.setItem('vh_brand', JSON.stringify(BRAND)); applyBrand(); toast('Brand reset'); renderRoute('#marketing'); });
    adminBox.querySelector('#exportBrand').addEventListener('click', ()=> download('brand.json', JSON.stringify(BRAND,null,2)));
    adminBox.querySelector('#importBrand').addEventListener('change', e=>{
      const f=e.target.files[0]; if(!f) return; f.text().then(t=>{ try{ const obj=JSON.parse(t); BRAND={...BRAND_DEFAULT,...obj}; localStorage.setItem('vh_brand', JSON.stringify(BRAND)); applyBrand(); toast('Brand imported'); renderRoute('#marketing'); }catch{ toast('Invalid JSON','warn'); }});
    });
    function renderPayments(){
      const box = $('#paymentsList',adminBox);
      const arr = JSON.parse(localStorage.getItem('vh_payments')||'[]');
      box.innerHTML = arr.length ? arr.slice().reverse().map(p=>`<div>â€¢ ${p.ts.split('T')[0]} â€” <b>${p.id}</b> â€” $${p.amount.toFixed(2)} â€” ${p.method} â€” Inv #${p.invoice} â€” ${p.name}</div>`).join('') : 'No payments yet.';
    }
    renderPayments();
    view.appendChild(adminBox);
  }
  return view;
}

/* ====== View: Contact ====== */
function renderContact({admin}={}){
  const view=document.createElement('section'); view.className='view active card';
  view.innerHTML=`
    <h2>Request a Quote</h2>
    <form id="reqForm">
      <div class="grid-2">
        <p><label>Name<br><input id="req_name" required placeholder="Your name"></label></p>
        <p><label>Email<br><input id="req_email" type="email" required placeholder="${BRAND.email}"></label></p>
      </div>
      <div class="grid-2">
        <p><label>Event Date<br><input id="req_date" type="date" required></label></p>
        <p><label>Guest Count<br><input id="req_guests" type="number" min="5" required placeholder="100"></label></p>
      </div>
      <p><label>Venue/Address<br><input id="req_addr" required placeholder="Venue or address"></label></p>
      <p><label>Notes<br><textarea id="req_notes" rows="4" placeholder="Tell us your vibe, must-have drinks, timelinesâ€¦"></textarea></label></p>
      <div style="display:flex; gap:10px; align-items:center" class="no-print">
        <button class="button" type="submit">Send Request (Demo)</button>
        <a class="iconbtn" id="mailtoBtn" href="#" aria-label="Send via email">Email</a>
        <span class="small">Prefer texting? <span data-bind="phone">${BRAND.phone}</span></span>
      </div>
    </form>
  `;
  function updateMailto(){
    const name=$('#req_name',view).value||'';
    const email=$('#req_email',view).value||'';
    const date=$('#req_date',view).value||'';
    const guests=$('#req_guests',view).value||'';
    const addr=$('#req_addr',view).value||'';
    const notes=$('#req_notes',view).value||'';
    const subject=encodeURIComponent(`Quote Request â€” ${name||'Event'}`);
    const body=encodeURIComponent(
`Hi ${BRAND.brand},

I'd like a quote for: ${date} Â· ${guests} guests
Venue: ${addr}

Notes:
${notes}

You can reach me at ${email}. Thank you!`);
    $('#mailtoBtn',view).href=`mailto:${BRAND.email}?subject=${subject}&body=${body}`;
  }
  ['req_name','req_email','req_date','req_guests','req_addr','req_notes'].forEach(id=> $('#'+id,view).addEventListener('input', updateMailto));
  updateMailto();

  $('#reqForm',view).addEventListener('submit', (e)=>{
    e.preventDefault();
    const rec={ id:'REQ-'+Math.random().toString(36).slice(2,8).toUpperCase(), ts:new Date().toISOString(),
      name:$('#req_name',view).value, email:$('#req_email',view).value, date:$('#req_date',view).value,
      guests:+$('#req_guests',view).value, addr:$('#req_addr',view).value, notes:$('#req_notes',view).value };
    const arr=JSON.parse(localStorage.getItem('vh_requests')||'[]'); arr.push(rec);
    localStorage.setItem('vh_requests', JSON.stringify(arr));
    toast(`Request logged: ${rec.id}`);
    e.target.reset(); updateMailto();
  });

  if(admin){
    const adminBox=document.createElement('div'); adminBox.className='card'; adminBox.style.marginTop='12px';
    const arr=JSON.parse(localStorage.getItem('vh_requests')||'[]').slice().reverse();
    adminBox.innerHTML=`
      <h3>Admin Â· Requests</h3>
      ${arr.length? arr.map(r=>`<div class="small">â€¢ <b>${r.id}</b> â€” ${r.ts.split('T')[0]} â€” ${r.name} â€” ${r.email} â€” ${r.date} â€” ${r.guests} guests â€” ${r.addr}</div>`).join('') : '<div class="small">No requests yet.</div>'}
      <div style="margin-top:8px; display:flex; gap:8px">
        <button class="iconbtn" id="exportReq">Export JSON</button>
        <button class="iconbtn" id="clearReq">Clear All</button>
      </div>
    `;
    adminBox.querySelector('#exportReq').addEventListener('click', ()=> download('requests.json', localStorage.getItem('vh_requests')||'[]'));
    adminBox.querySelector('#clearReq').addEventListener('click', ()=>{ localStorage.removeItem('vh_requests'); toast('Requests cleared'); renderRoute('#contact'); });
    view.appendChild(adminBox);
  }
  return view;
}

/* ====== Shared Payment Simulation ====== */
$('#fillInvoiceAmt').addEventListener('click', ()=>{
  const totText = $('#app')?.querySelector('#inv_tot')?.innerText || '$0.00';
  $('#pay_amount').value = totText.replace(/[^0-9.]/g,'') || '0.00';
});
$('#confirmPay').addEventListener('click', ()=>{
  const name=$('#pay_name').value.trim();
  const amt=parseFloat($('#pay_amount').value)||0;
  const method=$('#pay_method').value;
  if(!name || !amt){ toast('Name and amount required','warn'); return; }
  const rec={ id:'PMT-'+Math.random().toString(36).slice(2,8).toUpperCase(), ts:new Date().toISOString(), name, amount:amt, method,
              invoice: $('#app')?.querySelector('#inv_no')?.value || 'â€”' };
  const arr=JSON.parse(localStorage.getItem('vh_payments')||'[]'); arr.push(rec);
  localStorage.setItem('vh_payments', JSON.stringify(arr));
  $('#payNotice').textContent = `Success: ${rec.id} for $${amt.toFixed(2)} via ${method}`;
  toast(`Payment recorded: ${rec.id}`);
});

/* ====== Hook up routes AFTER views exist ====== */
routes['#packages']  = renderPackages;
routes['#menus']     = renderMenus;
routes['#designer']  = renderDesigner;
routes['#calculator']= renderCalculator;
routes['#contract']  = renderContract;
routes['#invoice']   = renderInvoice;
routes['#checklists']= renderChecklists;
routes['#marketing'] = renderMarketing;
routes['#contact']   = renderContact;
routerReady = true;

/* ====== Admin gating (moved AFTER router is ready) ====== */
const ADMIN_FLAG='vh_is_admin';
const REMEMBER_FLAG='vh_admin_remember';
const PIN_KEY='vh_admin_pin';
function storageForState(){ return (localStorage.getItem(REMEMBER_FLAG)==='1') ? localStorage : sessionStorage; }
function isAdmin(){ try{ return storageForState().getItem(ADMIN_FLAG)==='1'; }catch{ return false; } }
function setAdmin(on){
  localStorage.removeItem(ADMIN_FLAG); sessionStorage.removeItem(ADMIN_FLAG);
  storageForState().setItem(ADMIN_FLAG, on?'1':'0');
  document.body.setAttribute('data-role', on?'admin':'user');
  $('#adminLogoutBtn').hidden = !on;
  $('#adminLoginBtn').hidden  =  on;
  $('#modeChip').textContent = `Mode: ${on?'Admin':'User'}`;
  if(routerReady){ renderRoute(location.hash || '#packages'); }
}
$('#adminLoginBtn').addEventListener('click', ()=> openPanel($('#pinPanel')));
$('#adminLogoutBtn').addEventListener('click', ()=> { localStorage.removeItem(ADMIN_FLAG); sessionStorage.removeItem(ADMIN_FLAG); localStorage.removeItem(REMEMBER_FLAG); setAdmin(false); toast('Signed out of admin','warn'); });
$('#confirmPin').addEventListener('click', ()=>{
  const input = $('#pinInput').value;
  const saved = localStorage.getItem(PIN_KEY) ?? '0000';
  const remember = $('#rememberAdmin').checked ? '1' : '0';
  localStorage.setItem(REMEMBER_FLAG, remember);
  if(input===saved){ setAdmin(true); closePanel($('#pinPanel')); toast('Admin unlocked','ok'); }
  else { toast('Incorrect PIN','warn'); }
});
$('#resetPin').addEventListener('click', ()=>{ localStorage.setItem(PIN_KEY,'0000'); toast('PIN reset to 0000','ok'); });

/* ====== Start app ====== */
window.addEventListener('hashchange', ()=> renderRoute(location.hash));
document.addEventListener('DOMContentLoaded', ()=>{
  // restore remembered admin session if set
  const remembered = localStorage.getItem(REMEMBER_FLAG)==='1';
  const rememberedAdmin = localStorage.getItem(ADMIN_FLAG)==='1';
  if(remembered && rememberedAdmin){ sessionStorage.setItem(ADMIN_FLAG,'1'); setAdmin(true); }
  else { sessionStorage.setItem(ADMIN_FLAG,'0'); setAdmin(false); }
  // demo param support: ?admin=1 (session only)
  const params=new URLSearchParams(location.search);
  if(params.get('admin')==='1'){ sessionStorage.setItem(ADMIN_FLAG,'1'); setAdmin(true); }
  // initial route
  renderRoute(location.hash || '#packages');
});
</script>
</body>
</html>